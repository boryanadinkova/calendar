<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>calendar</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" type="text/css" href="css/main.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.20.1/moment.min.js"></script>
</head>
<body>
<div class="content-wrapper">
    <div class="wrapper">
        <div class="date" id="header"></div>
        <div class="calendar-header">
            <div class="calendar-item-header" id="Sunday">Su</div>
            <div class="calendar-item-header" id="Monday">Mo</div>
            <div class="calendar-item-header" id="Tuesday">Tu</div>
            <div class="calendar-item-header" id="Wednesday">We</div>
            <div class="calendar-item-header" id="Thursday">Th</div>
            <div class="calendar-item-header" id="Friday">Fr</div>
            <div class="calendar-item-header" id="Saturday">Sa</div>
        </div>
        <div class="calendar-body" id="container">

        </div>

        <div class="month-switch">
            <div class="arrow-left" id="arrow-left"></div>
            <div class="month-container" id="month-container"></div>
            <div class="arrow-right" id="arrow-right"></div>
        </div>
    </div>
</div>
<div id="simpleModal" class="modal">
    <div class="modal-content">
        <div class="modal-header">
            <h2 id="modalHeader"></h2>
            <span class="closeBtn">&times;</span>
        </div>
        <div class="modal-body" id="modal-body">
            <p id="hour"></p>
            <textarea id="textarea"></textarea>
        </div>
        <div class="modal-footer">
            <div class="modal-arrow-left" id="modal-arrow-left"></div>
            <div class="modal-arrow-right" id="modal-arrow-right"></div>
        </div>
    </div>
</div>
</body>
<footer>
    <script>


        // getting elements from DOM
        const header = document.getElementById("header");
        const body = document.getElementById("container");
        const days = document.getElementsByClassName('calendar-item');
        const leftArrow = document.getElementById("arrow-left");
        const rightArrow = document.getElementById("arrow-right");
        const monthContainer = document.getElementById("month-container");
        const modalHeader = document.getElementById("modalHeader");
            //Get modal elements
        const modal = document.getElementById('simpleModal');
        const closeBtn = document.getElementsByClassName('closeBtn')[0];
        const leftModalArrow = document.getElementById('modal-arrow-left');
        const rightModalArrow = document.getElementById('modal-arrow-right');
        const modalTimeField = document.getElementById("hour");

        // getting instance from moment.js
        const now = moment();

        // getting date, month, year in format (01 01 2000)
        let currentDay = now.format("DD");
        let month = now.format('MM');

        // fields to be filled with calendar data
        let calendarCells = '';
        let blankCell = '';

        // console.log(moment().startOf("month").format("dd"));


        const clearBox = elementID => {
            const div = document.getElementById(elementID);
            while (div.firstChild) {
                div.removeChild(div.firstChild);
            }
        };

        /* -------- Declaring functions - START --------*/
        // HTML templates
        const creatingCells = (monthDay, month, year, today) => {
            return `<div data-day="${monthDay}" data-month="${month}" data-year="${year}" class="calendar-item ${today}"> ${monthDay} </div>`;
        };

        //HTML cells generator - START

        const fillBlankCell = now => {
            for (let blank = 0; blank < getFirstDayOfMonth(now); blank++) {
                blankCell += "<div class='calendar-item'></div>"
            }
        };

        //HTML cells generator - END


        // Get proper date in proper format

        const fillCalendarCells = now => {
            for (let monthDay = 1; monthDay <= getLastDayOfMonth(now); monthDay++) {
                let today = "";
                if (monthDay == currentDay) {
                    today = "highlight";
                }
                calendarCells += creatingCells(monthDay, now.format('MM'), now.format('YYYY'), today);
            }
        };

        // Returns first day of month as weekday in format (1-7).
        const getFirstDayOfMonth = now => {
            return moment(now).startOf("month").format("d");
        };

        // Returns last day of month in format (1-31) to determine the length of month.OK
        const getLastDayOfMonth = now => {
            return moment(now).endOf("month").format("DD");
        };

        // Returns number of days for next months and previous months. (month) argument needs to be an integer. OK
        const getDaysOfNextMonth = month => {
            return getLastDayOfMonth(now.add(month, "months"));
        };


        const getDaysOfPreviousMonth = month => {
            return getLastDayOfMonth(now.subtract(month, "months"));
        };

        // Returns date in format 01 January 2000

        const getDateToday = date => {
            return moment(date).format("DD MMMM YYYY");
        };

        //Attach click event to calendar cells to display cell content in format Monday-Sunday OK
        const addEventListenerToCell = () => {
            for (const day of days) {
                // day.addEventListener('click', function (event) {
                //     const datasetTarget = event.target.dataset;
                //     console.log(moment(`${datasetTarget.year}-${datasetTarget.month}-${datasetTarget.day}`).format('dddd'));
                //
                // });
                day.addEventListener('click', openModal);
            }
        };

        //Render functions - START
        const renderCalendarBody = now => {
            fillBlankCell(now);
            fillCalendarCells(now);
        };

        const renderCalendar = now => {
            renderCalendarBody(now);

            //Fill all HTML to calendar
            body.innerHTML = blankCell + calendarCells;
            header.innerHTML = getDateToday();
            monthContainer.innerHTML = now.format('MMMM YYYY');
        };

        //Render functions - END

        /* -------- Declaring functions - END --------*/


        leftArrow.addEventListener('click', function () {
            clearBox("container");
            now.add(-1, "months");
            calendarCells = '';
            blankCell = '';
            renderCalendar(now);
            addEventListenerToCell()
        });

        rightArrow.addEventListener('click', function () {
            clearBox("container");
            now.add(1, "months");
            calendarCells = '';
            blankCell = '';
            renderCalendar(now);
            addEventListenerToCell()
        });


        //
        renderCalendar(now);
        addEventListenerToCell();


        //Event listeners Modal

        //    listen for close click
        closeBtn.addEventListener('click', closeModal);
        //    listen for outside click
        window.addEventListener('click', clickOutside);

        //Functions Modal - START
        //    function to openModal
        const openModal = event => {
            console.log(this);
            modalHeader.innerHTML = (moment(`${this.dataset.year}-${this.dataset.month}-${this.dataset.day}`).format('DD MMMM YYYY'));
            //console.log(event.target);
            modal.classList.add("visible");
            // modal.style.display = "block";
        };

        //    function to openModal
        const closeModal = () => {
            modal.classList.remove("visible");
        };

        //function to closeModal on click outside
        const clickOutside = outside => {
            if (outside.target == modal) {
                // modal.style.display = "none";
                modal.classList.remove("visible");
            }
        };

        //    Functions Modal - END

        let hours = ["7:00 AM", "8:00 AM", "9:00 AM", "10:00 AM", "11:00 AM", "12:00 PM", "1:00 PM", "2:00 PM", "3:00 PM", "4:00 PM", "5:00 PM", "6:00 PM", "7:00 PM", "8:00 PM"];

        modalTimeField.innerHTML = hours[0];

        console.log(hours.length);
        // Modal arrows onclick function - add one hour to hours of the day, clear textarea and display new one, for the new hour.

        // leftModalArrow.addEventListener('click', function () {
        //     // now.add(-1,"hours");
        //     clearBox("textarea");
        // });
        //
        // rightModalArrow.addEventListener('click', function () {
        //     // now.add(-1,"hours");
        //     clearBox("textarea");
        // });


    </script>
</footer>
</html>